<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrimePicks Link Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 50px;
    background-color: #f5f5f5;
  }
  h1 { color: #222; margin-bottom: 20px; }
  .button-container { margin-bottom: 30px; }
  button {
    margin: 10px;
    padding: 15px 25px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #007bff;
    color: #fff;
    transition: background 0.3s;
  }
  button:hover { background-color: #0056b3; }
  table {
    margin: 0 auto;
    border-collapse: collapse;
    width: 80%;
    max-width: 600px;
    background: #fff;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 12px 15px;
    text-align: center;
  }
  th { background: #007bff; color: #fff; }
</style>
</head>
<body>
<h1>PrimePicks Link Tracker</h1>

<div class="button-container">
  <button data-linkid="website" data-url="https://primepickstip.onrender.com/">Visit Website</button>
  <button data-linkid="apk" data-url="https://median.co/share/rdejjdb#apk">Download APK</button>
  <button data-linkid="telegram" data-url="https://t.me/primepicks254">Telegram</button>
  <button data-linkid="facebook" data-url="https://www.facebook.com/profile.php?id=61581288185889">Facebook</button>
</div>

<h2>Click Stats (auto-refresh every 5s)</h2>
<table>
  <thead>
    <tr>
      <th>Link</th>
      <th>Clicks Today</th>
    </tr>
  </thead>
  <tbody id="stats-body">
    <tr><td colspan="2">Loading stats...</td></tr>
  </tbody>
</table>

<script>
(async function(){
  // === Replace with your Render live URL ===
  const API = "https://primepickstip.onrender.com/api";

  // --- get or register userId ---
  let userId = localStorage.getItem("pp_userId");
  if(!userId){
    try {
      const r = await fetch(API + "/register", {method:"POST"});
      const j = await r.json();
      if(j.success) userId = j.userId;
      localStorage.setItem("pp_userId", userId);
    } catch(err){ console.error(err); }
  }

  // --- button click handler ---
  const buttons = document.querySelectorAll("button");
  buttons.forEach(btn => {
    btn.addEventListener("click", async () => {
      const linkId = btn.dataset.linkid;
      const linkUrl = btn.dataset.url;

      try{
        const resp = await fetch(API + "/click", {
          method:"POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify({ userId, linkId, linkUrl })
        });
        const j = await resp.json();
        console.log("Click response:", j);
      } catch(err){ console.error(err); }

      window.open(linkUrl, "_blank");
    });
  });

  // --- fetch and display stats ---
  async function updateStats(){
    try{
      const r = await fetch(API + "/stats");
      const j = await r.json();
      if(j.success){
        const statsBody = document.getElementById("stats-body");
        statsBody.innerHTML = "";
        const links = ["website","apk","telegram","facebook"];
        links.forEach(id => {
          const count = j.stats[id]?.totalCount || 0;
          const row = `<tr><td>${id}</td><td>${count}</td></tr>`;
          statsBody.innerHTML += row;
        });
      }
    } catch(err){ console.error(err); }
  }

  // initial load & auto-refresh every 5s
  updateStats();
  setInterval(updateStats, 5000);
})();
</script>
</body>
</html>
